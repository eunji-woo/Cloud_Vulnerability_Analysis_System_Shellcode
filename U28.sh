#!/bin/bash

<<<<<<< HEAD
# 작성날짜 : 2022년 7월 6일 , 8월 24일
# 작성자 : 우은지, 이은경
=======
# 작성날짜 : 2022년 7월 6일 
# 작성자 : 우은지
>>>>>>> 03f5de9f689ec24457c298763162cb95ebfbba95
# 동작방식 : NIS, NIS+ 서비스가 구동 중인지 확인하는 코드

# ps: 현재 실행 중인 프로세스 상태, 목록 출력해주는 명령어 (e 옵션: 모든 프로세스, f 옵션: UID, PID, PPID 등이 같이 출력됨 = full 포맷)
# wc: 주어지는 파일 또는 표준 입력의 바이트, 문자, 단어 그리고 줄(라인) 수를 출력해주는 명령어
# ypesrv|ypbind|ypxfrd|rpc.yppasswdd|rpc.ypupdated -> NIS 서비스의 주요 데몬들 (ypserv : NIS 서버 데몬, yppasswdd : NIS 클라이언트에서 패스워드를 변경하도록 해주는 데몬, ypxfrd : NIS서버와 클라이언트간의 맵핑 속도를 높여주는 데몬)
<<<<<<< HEAD
# egrep: grep의 확장판으로서 grep가 하나의 문자열을 찾는 것 과는 달리, 여러개의 문자열을 동시에 찾을 수 있고, grep에서 활용할 수 있는 메타문자 이외에 추가 정규표현식 메타문자를 지원

vuln_number="U28"
vuln_name="NIS, NIS+ 점검"
vuln_result_date="$(date +%Y)-$(date +%m)-$(date +%d) $(date +%H):$(date +%M):$(date +%S)"
vuln_type="서비스 관리"
vuln_severity="3"
vuln_result="취약하지 않음"
vuln_desc="NIS, NIS+ 서비스가 구동중이지 않음"


if [ "$(ps -ef | grep -E "ypesrv|ypbind|ypxfrd|rpc.yppasswdd|rpc.ypupdated" | grep -v "grep" | wc -l)" -ge 1 ] #프로세스 목록에 NIS 관련 데몬 내용이 1줄 이상 있다면
then
    vuln_result="취약함"
    vuln_desc="불필요한 서비스가 구동중임"
fi

echo "{\"vuln_number\":\"${vuln_number}\", \"vuln_name\":\"${vuln_name}\", \"vuln_result_date\":\"${vuln_result_date}\", \"vuln_type\":\"${vuln_type}\", \"vuln_severity\":\"${vuln_severity}\", \"vuln_result\":\"${vuln_result}\", \"vuln_desc\":\"${vuln_desc}\", \"vuln_host_id\":\"${vuln_host_id}\"}" >> result.log
=======
if [ `ps -ef | grep -E "ypesrv|ypbind|ypxfrd|rpc.yppasswdd|rpc.ypupdated" | grep -v "grep" | wc -l` -ge 1 ] # 프로세스 목록에 NIS 관련 데몬 내용이 1줄 이상 있다면
    then
        echo -e "[unsafe] use NIS, NIS+ service\n\n" >> u28.log
    else
        echo -e "[safe] unuse NIS, NIS+ service\n\n" >> u28.log
fi
>>>>>>> 03f5de9f689ec24457c298763162cb95ebfbba95
