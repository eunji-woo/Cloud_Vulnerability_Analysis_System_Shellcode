#!/bin/bash

# 작성날짜 : 2022년 6월 8일 
# 작성자 : 우은지
# 동작방식 : /etc/hosts 파일의 보호가 잘 이루어지고 있는지 확인하기 위한 코드
# -> /etc/hosts 파일의 권한과 소유자를 stat 명령을 통해 확인하고, 권한이 644 이하이고 소유자가 root면 safe, 권한이 644 초과하거나 소유자가 root가 아니면 unsafe로 판단

vuln_number="U10"
vuln_name="/etc/hosts 파일 소유자 및 권한 설정"
vuln_result_date="$(date +%Y)-$(date +%m)-$(date +%d) $(date +%H):$(date +%M):$(date +%S)"
vuln_type="계정 관리"
vuln_severity="3"
vuln_result="취약함"
vuln_desc=""
vuln_host_id=$(hostname -I)

# stat -c 옵션 = 입력한 포맷대로 출력
check1=$(stat -c %a '/etc/hosts') # stat %a 포매팅 = 권한을 8진수로 알려줌
check2=$(stat -c "%U" '/etc/hosts') # stat %U 포매팅 = 파일 소유자 알려줌

if [ `expr $check1` -le 644 ]; then # expr 명령을 사용하여 check1의 값을 표현식으로 변환 (숫자로)
    if [ $check2 == "root" ]; then
        vuln_result="취약하지 않음"
    else
        vuln_desc="/etc/hosts 파일 소유자가 root가 아님"
    fi
else
    if [ $check2 == "root" ]; then
        vuln_desc="/etc/hosts 파일 권한이 644 이상임"
    else
        vuln_desc="/etc/hosts 파일 권한이 644 이상이며 파일 소유자가 root가 아님"
    fi
fi

echo "{\\"vuln_number\\":\\"${vuln_number}\\", \\"vuln_name\\":\\"${vuln_name}\\", \\"vuln_result_date\\":\\"${vuln_result_date}\\", \\"vuln_type\\":\\"${vuln_type}\\", \\"vuln_severity\\":\\"${vuln_severity}\\", \\"vuln_result\\":\\"${vuln_result}\\", \\"vuln_desc\\":\\"${vuln_desc}\\", \\"vuln_host_id\\":\\"${vuln_host_id}\\"}" >> result.log
