#!/bin/bash

# 작성날짜 : 2022년 6월 8일 
# 작성자 : 우은지
# 동작방식 : suid, sgid, sticky bit 설정 파일을 점검 확인하기 위한 코드
# -> suid, sgid가 허용된 파일들을 출력시켜 확인하기 위한 코드이다.

vuln_number="U14"
vuln_name="SUID, SGID, Sticky bit 설정 파일 점검"
vuln_result_date="$(date +%Y)-$(date +%m)-$(date +%d) $(date +%H):$(date +%M):$(date +%S)"
vuln_type="계정 관리"
vuln_severity="3"
vuln_result="취약함"
vuln_desc=`find  / -user root -type f \\( -perm -4000 -o -perm -2000 \\) -exec ls -lg {} \; 2>&1 >/dev/null`
vuln_host_id=$(hostname -I)

# user 옵션 =  지정한 사용자의 파일이나 디렉토리를 찾음, 여기선 root
# type 옵션 = 지정한 파일 유형만 찾음, f는 일반 파일 의미
# perm 옵션은 권한 의미, perm -4000 = suid, perm -2000 = sgid, 에러 메시지들은 /dev/null로 버림 (2> 를 이용한 리다이렉션)

if [ -z "$vuln_desc" ]; then
    vuln_result="취약하지 않음"
else
    vuln_desc="suid, sgid에 대한 설정이 부여되지 않은 파일 존재, 중요하지 않은 파일이라면 무시"
fi

echo "{\\"vuln_number\":\\"${vuln_number}\\", \\"vuln_name\\":\\"${vuln_name}\\", \\"vuln_result_date\\":\\"${vuln_result_date}\\", \\"vuln_type\\":\\"${vuln_type}\\", \\"vuln_severity\\":\\"${vuln_severity}\\", \\"vuln_result\\":\\"${vuln_result}\\", \\"vuln_desc\\":\\"${vuln_desc}\\", \\"vuln_host_id\\":\\"${vuln_host_id}\\"}" >> result.log
