#!/bin/bash

# 작성날짜 : 2022년 6월 8일, 8월 24일
# 작성자 : 우은지, 이은경
# 동작방식 : finger 서비스 비활성화가 설정되어 있는지 xinetd 서비스에서 finger 파일을 보고 확인하는 코드
# -> finger 서비스 파일에 disable가 grep될 경우 safe로 판단, grep되지 않을 경우 unsafe로 판단



vuln_number="U20"
vuln_name="Finger 서비스 비활성화"
vuln_result_date="$(date +%Y)-$(date +%m)-$(date +%d) $(date +%H):$(date +%M):$(date +%S)"
vuln_type="서비스 관리"
vuln_severity="3"
vuln_result="취약하지 않음"
vuln_desc="finger 서비스 관련 파일이 없음"
vuln_host_id=$(hostname -I)

value1=$(cat /etc/xinetd.d/finger | grep "disable")

if [[ $value1 == *yes* ]]; then # finger 서비스가 disable 설정되어 있다면
    vuln_desc="finger 서비스가 활성화 되어 있음"
    vuln_result="취약함"
else 
    vuln_desc="finger 서비스가 활성화 되어 있지 않음" #현재 이렇게 뜸 파일 유무 걸러야 할 듯
    vuln_result="취약하지 않음"
fi

echo "{\"vuln_number\":\"${vuln_number}\", \"vuln_name\":\"${vuln_name}\", \"vuln_result_date\":\"${vuln_result_date}\", \"vuln_type\":\"${vuln_type}\", \"vuln_severity\":\"${vuln_severity}\", \"vuln_result\":\"${vuln_result}\", \"vuln_desc\":\"${vuln_desc}\", \"vuln_host_id\":\"${vuln_host_id}\"}" >> result.log