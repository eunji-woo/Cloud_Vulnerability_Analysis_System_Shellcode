#!/bin/bash

# 작성날짜 : 2022년 6월 8일, 8월 24일
# 작성자 : 이은경
# 동작방식 : /etc/hosts.deny, allow에서 접속을 허용할 특정 호스트에 대한 IP 주소와 포트 제한 설정
# ->host.deny에서 모든 파일을 거부하고, host.allow에서 특정 호스트를 설정하면 safe, 그렇지 않으면 unsafe

vuln_number="U18"
vuln_name="접속 IP 및 포트 제한"
vuln_result_date="$(date +%Y)-$(date +%m)-$(date +%d) $(date +%H):$(date +%M):$(date +%S)"
vuln_type="파일 및 디렉토리 관리"
vuln_severity="3"
vuln_result="취약하지 않음"
vuln_desc="모든 프로세스의 접속을 거부시키되, 특정 프로세스는 허용하고 있음"
vuln_host_id=$(hostname -I)

vaule=$(cat /etc/hosts.deny | grep 'ALL' )

if [[ $value == *:* ]];then
    vuln_desc="모든 호스트의 접속을 거부함"
else
    vuln_desc="모든 호스트의 접속을 거부하고 있지 않음"
    vuln_result="취약함"
fi

echo "{\"vuln_number\":\"${vuln_number}\", \"vuln_name\":\"${vuln_name}\", \"vuln_result_date\":\"${vuln_result_date}\", \"vuln_type\":\"${vuln_type}\", \"vuln_severity\":\"${vuln_severity}\", \"vuln_result\":\"${vuln_result}\", \"vuln_desc\":\"${vuln_desc}\", \"vuln_host_id\":\"${vuln_host_id}\"}" >> result.log