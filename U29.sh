#!/bin/bash

# 작성날짜 : 2022년 7월 6일 
# 작성자 : 우은지, 이은경
# 동작방식 : 사용하지 않는 tftp, talk 서비스가 활성화 되어있는지 확인하는 코드

value1=$(cat /etc/xinetd.d/tftp | grep "disable")
value2=$(cat /usr/bin/talk | grep "disable")
# value3=$(cat /etc/xinetd.d/ntalk | grep "disable")
vuln_number="U29"
vuln_name="tftp, talk 서비스 비활성화"
vuln_result_date="$(date +%Y)-$(date +%m)-$(date +%d) $(date +%H):$(date +%M):$(date +%S)"
vuln_type="서비스 관리"
vuln_severity="3"
vuln_result="취약하지 않음"
vuln_desc="해당 파일 또는 서비스가 없습니다."
vuln_host_id=$(hostname -I)

vuln_flag1=0 # 취약하지 않음
vuln_flag2=0 # 취약하지 않음

# /etc/xinetd.conf 파일이란: 해당 디렉토리 내에 존재하는 inetd 서비스 파일들에 공통적으로 적용되는 설정 내용들이 저장되어있는 파일
if [ ${value1:(-3)} == "yes" ]; then
    vuln_flag1=1
fi

if [ ${value2:(-3)} == "yes" ]; then
    vuln_flag2=2
fi

if [ $vuln_flag1 == 1 ] || [ $vuln_flag2 == 1 ];then
    vuln_result="talk 또는 tftp가 활성화 되어있어 취약함 (사용중인게 아니라면 비활성화 필요)"
else
    vuln_desc="talk, tftp가 비활성화 되어있음"   
fi

echo "{\\"vuln_number\\":\\"${vuln_number}\\", \\"vuln_name\\":\\"${vuln_name}\\", \\"vuln_result_date\\":\\"${vuln_result_date}\\", \\"vuln_type\\":\\"${vuln_type}\\", \\"vuln_severity\\":\\"${vuln_severity}\\", \\"vuln_result\\":\\"${vuln_result}\\", \\"vuln_desc\\":\\"${vuln_desc}\\", \\"vuln_host_id\\":\\"${vuln_host_id}\\"}" >> result.log
