#!/bin/bash

# 작성날짜 : 2022년 6월 8일 
# 작성자 : 우은지
# 동작방식 : 패스워드 파일 보호가 잘 이루어지고 있는지 확인하기 위한 코드 
# (shadow 파일이 존재하는지 test 명령을 이용해 확인하고, passwd 파일이 암호화 되어있는지, 즉 두번째 필드에 x가 있는지 확인하는 코드
# -> shadow 파일을 사용하거나 passwd 파일을 암호화해서 사용하는 경우 safe로 판단, shadow 파일을 사용하지 않거나 passwd 파일을 암호화하지 않고 사용하는 경우 unsafe로 판단)

vuln_number="U05"
vuln_name="패스워드 파일 보호"
vuln_result_date="$(date +%Y)-$(date +%m)-$(date +%d) $(date +%H):$(date +%M):$(date +%S)"
vuln_type="계정 관리"
vuln_severity="3"
vuln_result="취약하지 않음"
vuln_desc="해당 파일 또는 서비스가 없습니다."
vuln_host_id=$(hostname -I)

if test -f '/etc/shadow'; then
    vuln_result="취약하지 않음"
    vuln_desc="shadow 파일 사용"
else
    if [ "`cat /etc/passwd | grep root:x`" ]; then
        vuln_result="취약하지 않음"  
        vuln_desc="passwd 파일 암호화"
    else
        vuln_result=" 취약함"
        vuln_desc="shadow 파일도 안 쓰고 passwd 파일 암호화도 안함"
    fi
fi


echo "{\\"vuln_number\\":\\"${vuln_number}\\", \\"vuln_name\\":\\"${vuln_name}\\", \\"vuln_result_date\\":\\"${vuln_result_date}\\", \\"vuln_type\\":\\"${vuln_type}\\", \\"vuln_severity\\":\\"${vuln_severity}\\", \\"vuln_result\\":\\"${vuln_result}\\", \\"vuln_desc\\":\\"${vuln_desc}\\", \\"vuln_host_id\\":\\"${vuln_host_id}\\"}" >> result.log
