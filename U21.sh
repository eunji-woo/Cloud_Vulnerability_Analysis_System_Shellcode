#!/bin/bash

# 작성날짜 : 2022년 8월 31일
# 작성자 : 이은경
# 동작방식 : anonymous 계정으로 로그인하여 디렉터리에 쓰기 권한이 설정되어 있는지 확인한다.
# 쓰기 권한이 있을 경우 local exploit을 사용하여 시스템을 공격할 수 있으므로 Anymous FTP 접속을 차단할 경우 safe, 차단하지 않을 경우 unsafe


vuln_number="U21"
vuln_name="Anonymous FTP 비활성화"
vuln_result_date="$(date +%Y)-$(date +%m)-$(date +%d) $(date +%H):$(date +%M):$(date +%S)"
vuln_type="서비스 관리"
vuln_severity="3"
vuln_result="취약하지 않음"
vuln_desc="Anonymous FTP 접속을 차단함"
vuln_host_id=$(hostname -I)


file1='etc/proftpd/proftpd.conf' #사용 시 anonymous~ftp 부분 확인, useralias 주석처리 되었거나 없으면 양호
file2='etc/vsftpd/vsftpd.conf' #anonymous_enable 값이 no로 되어 있으면 양호
#어떤 FTP를 사용하는지에 따라 봐야하는 파일이 다른데 centos7은 기본적으로 dafaultFTP를 쓰고 있음

ftpCheck=`cat /etc/passwd | grep ftp | cut -d ':' -f1`

if [ $ftpCheck == 'ftp' ];then
    vuln_desc="ftp 계정이 존재함"
    vuln_result="취약함"
else
    desc+=" - ftp 계정이 존재하지 않음"
fi


echo "{\\"vuln_number\":\\"${vuln_number}\\", \\"vuln_name\\":\\"${vuln_name}\\", \\"vuln_result_date\\":\\"${vuln_result_date}\\", \\"vuln_type\\":\\"${vuln_type}\\", \\"vuln_severity\\":\\"${vuln_severity}\\", \\"vuln_result\\":\\"${vuln_result}\\", \\"vuln_desc\\":\\"${vuln_desc}\\", \\"vuln_host_id\\":\\"${vuln_host_id}\\"}" >> result.log
