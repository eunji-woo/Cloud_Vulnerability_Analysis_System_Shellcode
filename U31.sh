#!/bin/bash

# 작성날짜 : 2022년 7월 6일 
# 작성자 : 우은지
# 동작방식 : SMTP 서버의 릴레이 기능 활성화 여부를 확인하는 코드

value1=$(ps -ef | grep "sendmail") # 현재 실행 중인 프로세스 목록에 sendmail이 있는지 grep하여 확인
value2=$(cat /etc/mail/sendmail.cf | grep "R$ \*" |grep "Relaying denied") # sendmail 설정 파일에 relaying service를 deny하고 있는지 grep하여 확인

if [ -n "$value1" ] # sendmail을 사용중이라면
    then
        if [ -n "$value2" ] # relaying service를 거부하고 있지 않다면
	then # 즉 sendmail은 사용하는데 relaying 서비스는 이용하는 상황
            echo -e "[unsafe] using SMTP-Relaying service" >> u31.log
	else # sendmail 사용하는데 relaying 서비스 거부된 경우
            echo -e "[safe] not using SMTP-Relaying service" >> u31.log
        fi
    else # sendmail 자체를 사용하지 않는 경우
        echo -e "[safe] not using sendmail service" >> u31.log
fi