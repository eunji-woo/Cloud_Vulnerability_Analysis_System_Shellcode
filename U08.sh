# /bin/bash

# 작성날짜 : 2022년 6월 8일 
# 작성자 : 우은지
# 동작방식 : /etc/passwd 파일의 보호가 잘 이루어지고 있는지 확인하기 위한 코드 
# -> /etc/passwd 파일을 ls 명령으로 확인 후, 소유자 부분을 빼와서 root인지 확인하고 root면 safe, 아니면 unsafe로 판단
checkFile=/etc/passwd

vuln_number="U8"
vuln_name="/etc/passwd 파일 소유자 및 권한 설정"
vuln_result_date="$(date +%Y)-$(date +%m)-$(date +%d) $(date +%H):$(date +%M):$(date +%S)"
vuln_type="계정 관리"
vuln_severity="3"
vuln_result=""
vuln_desc=""
vuln_host_id=$(hostname -I)

# etc/passwd의 ls 결과에서 3번째 행의 값을 가져와서 (awk 명령) check1 변수에 저장
check1=`ls -l $checkFile | awk '{print $3}'` 

if [ $check1 == 'root' ];then # check1의 값, 즉 /etc/passwd의 소유자가 root인지 확인
    vuln_result="취약하지 않음" 
    vuln_desc="/etc/passwd의 소유자가 root임" 
else
    vuln_result="취약함" 
    vuln_desc="/etc/passwd의 소유자가 root가 아님" 
fi

echo "{\\"vuln_number\":\\"${vuln_number}\\", \\"vuln_name\\":\\"${vuln_name}\\", \\"vuln_result_date\\":\\"${vuln_result_date}\\", \\"vuln_type\\":\\"${vuln_type}\\", \\"vuln_severity\\":\\"${vuln_severity}\\", \\"vuln_result\\":\\"${vuln_result}\\", \\"vuln_desc\\":\\"${vuln_desc}\\", \\"vuln_host_id\\":\\"${vuln_host_id}\\"}" >> result.log
