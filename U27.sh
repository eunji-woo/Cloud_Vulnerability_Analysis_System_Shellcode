#!/bin/bash

# 작성날짜 : 2022년 6월 2일, 9월 14일 
# 작성자 : 우은지, 이은경
# 동작방식 : BOF, Dos, 원격 실행 등 취약성이 존재하는 RPC 서버는 root 권한 획득 및 침해사고 발생을 야기하므로 해당 서비스가 활성화되어 있는지 검사한다.
# 불필요한 RPC 서비스가 비활성화 되어 있는 경우 safe, 활성화 되어 있는 경우 unsafe

vuln_number="U27"
vuln_name="RPC 서비스 확인"
vuln_result_date="$(date +%Y)-$(date +%m)-$(date +%d) $(date +%H):$(date +%M):$(date +%S)"
vuln_type="서비스 관리"
vuln_severity="3"
vuln_result="취약하지 않음"
vuln_desc="불필요한 RPC 서비스가 활성화 되어 있지 않음"
vuln_host_id=$(hostname -I)

rpcService=("rpc", "cmsd", "rpc.ttdbserverd", "sadmind", "rusersd", "walld", "sprayd", "rstatd", "rpc.nisd", "rexd", "rpc.pcnfsd", "rpc.statd", "rpc.ypupdated", r"pc.rquotad", "kcms_server", "cachefsd")

for x in rpcService
do
    check=$(ls -al /etc/xinetd.d | grep $x)
    if [ -n $check ];then
        vuln_desc+="$x "
        vuln_result="취약함"
    fi
done

echo "{\"vuln_number\":\"${vuln_number}\", \"vuln_name\":\"${vuln_name}\", \"vuln_result_date\":\"${vuln_result_date}\", \"vuln_type\":\"${vuln_type}\", \"vuln_severity\":\"${vuln_severity}\", \"vuln_result\":\"${vuln_result}\", \"vuln_desc\":\"${vuln_desc}\", \"vuln_host_id\":\"${vuln_host_id}\"}" >> result.log
