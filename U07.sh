#!/bin/bash

# 작성날짜 : 2022년 6월 8일 
# 작성자 : 우은지
# 동작방식 : 파일 및 디렉터리 소유자 설정을 확인하기 위한 코드 
# -> find 명령 이용해서 소유자나 그룹이 없는 파일이 존재할 경우 unsafe, 존재하지 않을 경우 safe로 판단

vuln_number="U7"
vuln_name="파일 및 디렉터리 소유자 설정"
vuln_result_date="$(date +%Y)-$(date +%m)-$(date +%d) $(date +%H):$(date +%M):$(date +%S)"
vuln_type="계정 관리"
vuln_severity="3"
vuln_result=""
vuln_desc=""
vuln_host_id=$(hostname -I)

# 루트 디렉토리부터 find하고, nouser 또는 nogroup인 걸 출력하고, 에러난 거 (2)는 dev/null에 버림
if [ -z "`find / -nouser -o -nogroup -print 2>/dev/null`" ]; then
    vuln_result="취약하지 않음"
    vuln_desc="소유자나 그룹이 없는 파일 존재하지 않음"
else 
    vuln_result="취약함"
    vuln_desc="소유자나 그룹이 없는 파일 존재"
fi

echo "{\\"vuln_number\":\\"${vuln_number}\\", \\"vuln_name\\":\\"${vuln_name}\\", \\"vuln_result_date\\":\\"${vuln_result_date}\\", \\"vuln_type\\":\\"${vuln_type}\\", \\"vuln_severity\\":\\"${vuln_severity}\\", \\"vuln_result\\":\\"${vuln_result}\\", \\"vuln_desc\\":\\"${vuln_desc}\\", \\"vuln_host_id\\":\\"${vuln_host_id}\\"}" >> result.log
