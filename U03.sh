#!/bin/bash

# 작성날짜 : 2022년 7월 27일 
# 작성자 : 우은지
# 동작방식 : 계정 잠금 임계값 확인을 위한 코드 (파일에서 임계값이 정의되어 있는지 확인 후, 정의되어 있을 경우 5 초과인지 확인하는 코드 
# -> 임계값이 설정되어있지 않거나 5를 초과하면 unsafe로 판단,  5이하의 경우 safe로 판단)

vuln_number="U3"
vuln_name="계정 잠금 임계값 설정"
vuln_result_date=$(date)
vuln_severity="3"
vuln_result=""
vuln_desc=""
vuln_host_id=$(hostname -I)

if [ "`cat /etc/pam.d/system-auth | grep deny=`" == "" -o "`cat /etc/pam.d/password-auth | grep deny=`" == "" ]; then # 임계값이 정의되어 있을만한 파일들에서 임계값이 저장되어 있는지 확인
    vuln_result="취약함"
    vuln_desc="임계값이 저장되어 있지 않음"
else  # 임계값이 정의되어 있다면
    if [ "`cat /etc/pam.d/system-auth | grep deny=[^1-5]`" -o "`cat /etc/pam.d/password-auth | grep deny=[^1-5]`" ]; then # 정의된 임계값이 1~5이면
        vuln_result="취약하지 않음"
        vuln_desc="임계값이 5 이하로 지정되어 있음"
    else
        vuln_result="취약함"  
        vuln_desc="임계값이 5 이하의 값으로 설정되어있지 않음"
    fi
fi

echo "{\\"vuln_number\":\\"${vuln_number}\\", \\"vuln_name\\":\\"${vuln_name}\\", \\"vuln_result_date\\":\\"${vuln_result_date}\\", \\"vuln_type\\":\\"${vuln_type}\\", \\"vuln_severity\\":\\"${vuln_severity}\\", \\"vuln_result\\":\\"${vuln_result}\\", \\"vuln_desc\\":\\"${vuln_desc}\\", \\"vuln_host_id\\":\\"${vuln_host_id}\\"}" >> result.log
