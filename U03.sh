#!/bin/bash

# 작성날짜 : 2022년 6월 8일 
# 작성자 : 우은지
# 동작방식 : 계정 잠금 임계값 확인을 위한 코드 (파일에서 임계값이 정의되어 있는지 확인 후, 정의되어 있을 경우 5 초과인지 확인하는 코드 
# -> 5를 초과하면 safe로 판단, 임계값이 설정되어있지 않거나 5이하의 경우 unsafe로 판단)

if [ "`cat /etc/pam.d/system-auth | grep deny=`" == "" -o "`cat /etc/pam.d/password-auth | grep deny=`" == "" ]; then # 임계값이 정의되어 있을만한 파일들에서 임계값이 저장되어 있는지 확인
    echo "unused deny" >> u03.log
    echo -e "[unsafe]\n\n" >> u03.log
else  # 임계값이 정의되어 있다면
    echo "use deny" >> u03.log
    
    if [ "`cat /etc/pam.d/system-auth | grep deny=[^1-5]`" -o "`cat /etc/pam.d/password-auth | grep deny=[^1-5]`" ]; then # 정의된 임계값이 1~5가 아니면
        echo "deny < 5" >> u03.log
    else
        echo "deny >= 5" >> u03.log
        echo -e "[safe]\n\n" >> u03.log
    fi
fi