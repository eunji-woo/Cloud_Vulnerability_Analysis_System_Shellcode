#!/bin/bash

# 작성날짜 : 2022년 6월 8일 
# 작성자 : 우은지
# 동작방식 : /etc/shadow 파일의 보호가 잘 이루어지고 있는지 확인하기 위한 코드
# -> /etc/shadow 파일의 권한과 소유자를 stat 명령을 통해 확인하고, 권한이 400 이하이고 소유자가 root면 safe, 권한이 400 초과하거나 소유자가 root가 아니면 unsafe로 판단

# stat -c 옵션 = 입력한 포맷대로 출력
check1=$(stat -c %a '/etc/shadow') # stat %a 포매팅 = 권한을 8진수로 알려줌
check2=$(stat -c "%U" '/etc/shadow') # stat %U 포매팅 = 파일 소유자 알려줌


if [ `expr $check1` -le 400 ]; then # expr 명령을 사용하여 check1의 값을 표현식으로 변환 (숫자로)
    echo "permission >= 400" >> u9.log
else
    echo "permission < 400" >> u9.log
fi
   

if [ $check2 == "root" ]; then # /etc/shadow 파일의 소유자가 root라면
    echo "UID is root" >> u9.log
else
    echo "UID is not root" >> u9.log
fi


if [ `expr $check1` -le 400 -a $check2 == "root" ]; then # 두 조건을 모두 만족한다면 safe
    echo -e "[safe]\n\n" >> u9.log
else
    echo -e "[unsafe]\n\n" >> u9.log # 그렇지 않다면 unsafe
fi