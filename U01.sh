# /bin/bash

# 작성날짜 : 2022년 7월 25일 
# 작성자 : 우은지
# 동작방식 : 원격 접속 가능한 터미널 장치들을 확인 -> root 직접 접속 차단되어 있는지 확인
# etc/securetty는 root가 로그인 가능한 터미널 장치들을 나열해둔 파일

value_pts=$(cat /etc/securetty | grep "pts") # pts 서비스를 사용하고 있는지 확인
value_tty=$(cat /etc/securetty | grep "tty") # tty 서비스를 사용하고 있는지 확인
value_rootlogin=$(cat /etc/ssh/sshd_config | grep "PermitRootLogin") # root 직접 접속 제한을 하고 있는지 확인

vuln_number="U1"
vuln_name="root 계정 원격 접속 제한"
vuln_result_date="$(date +%Y)-$(date +%m)-$(date +%d) $(date +%H):$(date +%M):$(date +%S)"
vuln_type="계정 관리"
vuln_severity="3"
vuln_result=""
vuln_desc=""
vuln_host_id=$(hostname -I)

if [ -z "$value_pts" ] && [ -z "$value_tty" ]; then 
    vuln_result="취약하지 않음" 
    vuln_desc="원격 터미널 서비스를 사용하지 않고 있음" 
else
    if [[ "$value_rootlogin" =~ "yes" ]]; then # value_rootlogin에 yes라는 내용이 포함되어 있는지 확인 (=~를 이용)
        vuln_result="취약함"
        vuln_desc="원격 터미널 서비스를 사용"
    else
        vuln_result="취약함"
        vuln_desc="원격 터미널 서비스를 사용하고, root 직접 접속을 제한하지 않음"     
    fi
fi

echo "{\"vuln_number\":\"${vuln_number}\", \"vuln_name\":\"${vuln_name}\", \"vuln_result_date\":\"${vuln_result_date}\", \"vuln_type\":\"${vuln_type}\", \"vuln_severity\":\"${vuln_severity}\", \"vuln_result\":\"${vuln_result}\", \"vuln_desc\":\"${vuln_desc}\", \"vuln_host_id\":\"${vuln_host_id}\"}" >> result.log
