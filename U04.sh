#!/bin/bash

# 작성날짜 : 2022년 6월 8일 
# 작성자 : 우은지
# 동작방식 : 패스워드 최대 사용 기간 확인을 위한 코드 
# -> 패스워드 최대 사용기간이 나와있는 파일을 읽은 후 최대 기간이 1~90의 숫자가 아닐 경우 unsafe 출력, 1~90일 경우 safe 출력

vuln_number="U4"
vuln_name="패스워드 최대 사용 기간 설정"
vuln_result_date="$(date +%Y)-$(date +%m)-$(date +%d) $(date +%H):$(date +%M):$(date +%S)"
vuln_type="계정 관리"
vuln_severity="2"
vuln_result=""
vuln_desc=""
vuln_host_id=$(hostname -I)

if [ "`cat /etc/login.defs | grep PASS_MAX_DAYS*[^1-90]`" ]; then
    vuln_result="취약함"
    vuln_desc="pw 최대 사용 기간 90일 초과"
else 
    vuln_result="취약하지 않음"
    vuln_desc="pw 최대 사용 기간 90일 이내"
fi

echo "{\"vuln_number\":\"${vuln_number}\", \"vuln_name\":\"${vuln_name}\", \"vuln_result_date\":\"${vuln_result_date}\", \"vuln_type\":\"${vuln_type}\", \"vuln_severity\":\"${vuln_severity}\", \"vuln_result\":\"${vuln_result}\", \"vuln_desc\":\"${vuln_desc}\", \"vuln_host_id\":\"${vuln_host_id}\"}" >> result.log